{{- $e := (index $.Site.Data.events (index (split ($.Page.Permalink | relURL) "/") 2)) -}}
{{- if $e -}}
  {{- $.Scratch.Set "coordinates" $e.coordinates -}}
{{- else -}}
  {{- $event_year := (index (split ($.Page.Permalink | relURL) "/") 2) -}}
  {{- $event_city := (index (split ($.Page.Permalink | relURL) "/") 3) -}}
  {{- $event_homepage := (printf "/new-events/%s/%s" $event_year $event_city) -}}
  {{- $event_data := .Site.GetPage $event_homepage -}}
  {{- with $event_data.Params.coordinates -}}
    {{- $.Scratch.Set "coordinates" . -}}
  {{- end -}}

{{- end -}}
{{- $coords := split ($.Scratch.Get "coordinates") "," -}}
{{- $lat := index $coords 0 -}}
{{- $lng := index $coords 1 -}}

<div id="map_canvas" style="width: 550px; height: 265px"></div>

<script type="text/javascript" language="javascript">
  function initMap() {
    var mapDiv = document.getElementById("map_canvas");
    var position = new google.maps.LatLng({{ $lat }}, {{ $lng }});

    var map = new google.maps.Map(mapDiv, {
      center: position,
      zoom: 14,
      mapTypeID: google.maps.MapTypeId.ROADMAP
    });

    var marker = new google.maps.Marker({
      position: position,
      map: map,
      title: "{{ $e.location }}",
    });
  }

  window.onload = function() {
    initMap();
  };
</script>

<script type="text/javascript" src="https://maps-api-ssl.google.com/maps/api/js?key=AIzaSyC1bvNK9qFJGEhoWNbQuojmJJ1Tg0DoOew"></script>
